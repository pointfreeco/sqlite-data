#if canImport(CloudKit)
  import CloudKit
  import ConcurrencyExtras
  import CustomDump
  import InlineSnapshotTesting
  import OrderedCollections
  import SQLiteData
  import SQLiteDataTestSupport
  import SnapshotTestingCustomDump
  import Testing

  extension BaseCloudKitTests {
    @MainActor
    final class AssetsTests: BaseCloudKitTests, @unchecked Sendable {
      @available(iOS 17, macOS 14, tvOS 17, watchOS 10, *)
      @Test func basics() async throws {
        let blackImageURL = Bundle.module.url(forResource: "test-black", withExtension: "svg")!
        let blackCoverImage = try Data(contentsOf: blackImageURL)
        
        try await userDatabase.userWrite { db in
          try db.seed {
            RemindersList(id: 1, title: "Personal")
            RemindersListAsset(remindersListID: 1, coverImage: blackCoverImage)
          }
        }

        try await syncEngine.processPendingRecordZoneChanges(scope: .private)

        assertInlineSnapshot(of: container, as: .customDump) {
          #"""
          MockCloudContainer(
            privateCloudDatabase: MockCloudDatabase(
              databaseScope: .private,
              storage: [
                [0]: CKRecord(
                  recordID: CKRecord.ID(1:remindersListAssets/zone/__defaultOwner__),
                  recordType: "remindersListAssets",
                  parent: CKReference(recordID: CKRecord.ID(1:remindersLists/zone/__defaultOwner__)),
                  share: nil,
                  coverImage_hash: Data(32 bytes),
                  remindersListID: 1,
                  coverImage: CKAsset(
                    fileURL: URL(file:///fb007a3c86694eb9c1122a4af617772e2396d8b093fd6e79981bff2221d78874),
                    dataString: """
                      <?xml version="1.0" ?>
                      <svg fill="#000000" width="800px" height="800px" viewBox="0 0 100 100" data-name="Layer 1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"><title/><path d="M86.99872,29.9895c-.00012-.01105-.0036-.02167-.00409-.03277a.99019.99019,0,0,0-.07178-.32221c-.00525-.01337-.00317-.0274-.009-.04065-.0036-.00812-.011-.01282-.01477-.02075a.9917.9917,0,0,0-.19812-.27911c-.018-.01789-.037-.03217-.05628-.04853a.98559.98559,0,0,0-.09-.07757l-36-24a.99857.99857,0,0,0-1.10938,0l-36,24a.98559.98559,0,0,0-.09.07757c-.01923.01636-.03827.03064-.05628.04853a.9917.9917,0,0,0-.19812.27911c-.00378.00793-.01117.01263-.01477.02075-.00586.01325-.00378.02728-.009.04065a.98747.98747,0,0,0-.07178.32239c-.00049.011-.004.02167-.00409.03265L13,30V70l.00073.0061c.00012.01465.0047.029.00543.04364a.99889.99889,0,0,0,.02832.20569c.00672.02533.01978.04859.02845.07343a1.00245,1.00245,0,0,0,.06683.15918l.007.01678c.01392.02381.0343.04187.05.06421a.98612.98612,0,0,0,.09454.12152,1.00707,1.00707,0,0,0,.08124.07007.97232.97232,0,0,0,.08276.07141l36,24a.9775.9775,0,0,0,.109.05127.95424.95424,0,0,0,.09924.04669.98514.98514,0,0,0,.693,0,.95424.95424,0,0,0,.09924-.04669.9775.9775,0,0,0,.109-.05127l36-24a463.02063,463.02063,0,0,1,.16607-.14325.994.994,0,0,0,.092-.119c.01624-.02313.037-.04187.05146-.06659l.00671-.01611a.99256.99256,0,0,0,.06415-.15308c.01-.02771.02447-.054.03186-.08227a1.00828,1.00828,0,0,0,.0202-.148.98466.98466,0,0,0,.01276-.103L87,70V30Zm-3.06525-.16534L68.30084,36.772l-3.47748-6.23736A.97217.97217,0,0,0,65,30a1,1,0,0,0-1-1h-.03217L52.88849,9.1275Zm-33.7771-21.49,11.5542,20.72424A.988.988,0,0,0,61,30a1,1,0,0,0,1,1h.793l3.34515,6H33.72583l3.439-6H38a1,1,0,0,0,1-1,.98727.98727,0,0,0-.721-.94373Zm-2.58374.4859L36.00592,29H36a1,1,0,0,0-1,1,.97236.97236,0,0,0,.14941.49432l-3.56817,6.22522L16.06653,29.82416ZM15,31.53876l15.58966,6.92877-5.454,9.696a.99806.99806,0,0,0-.63824.10352,1.01187,1.01187,0,0,0-.38788,1.38049l.09582.1698L15,66.18243Zm10.41705,20.204a1.01014,1.01014,0,0,0,1.46283-1.32208l-.36017-.63819L32,40.03973l5.54987,9.8664-.13062.225a.9766.9766,0,0,0,.39685,1.35462,1.04677,1.04677,0,0,0,.67731.09784l5.61523,9.9826A.97983.97983,0,0,0,44,62a.9906.9906,0,0,0,.9043.98065L48.29016,69H15.70984ZM49,92.13141,17.30286,71H49Zm1-24.17114-2.81152-4.99836A.986.986,0,0,0,48,62a1,1,0,0,0-1-1h-.91516L39.87976,49.96863l.41345-.7124a.97673.97673,0,0,0-.39691-1.35462,1.06368,1.06368,0,0,0-1.13385.08069L33.7099,39H66.29016l-5.05261,8.98242a1.06,1.06,0,0,0-1.13324-.08026.97769.97769,0,0,0-.39453,1.355l.4118.70923L53.91516,61H53a1,1,0,0,0-1,1,.98611.98611,0,0,0,.81158.962Zm1,24.17114V71H82.69714ZM51.70984,69l3.38586-6.01935A.99065.99065,0,0,0,56,62a.98.98,0,0,0-.10864-.43384l5.61523-9.9826a1.04291,1.04291,0,0,0,.678-.09839.97774.97774,0,0,0,.39459-1.355l-.12957-.22315,5.47308-9.72992,5.50494,9.69867-.30755.54493A1.00341,1.00341,0,0,0,74.50854,51.78L84.28253,69ZM85,66.21234,75.74463,49.90619l.14593-.25861A1.00958,1.00958,0,0,0,74.76031,48.172l-5.47637-9.64832L85,31.53876Z"/><path d="M21.89319,41.58527a1.01632,1.01632,0,0,0-1.773.994l.99725,1.76709a1.01635,1.01635,0,0,0,1.77307-.994Z"/><path d="M29.87183,55.722a1.01628,1.01628,0,0,0-1.77295.994l.99725,1.76709a1.01633,1.01633,0,0,0,1.77307-.994Z"/><path d="M17.90387,34.51691a1.01635,1.01635,0,0,0-1.77307.994l.99731,1.767a1.01632,1.01632,0,0,0,1.77307-.99389Z"/><path d="M30,29H28a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M22,29H20a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M44,31h2a1,1,0,0,0,0-2H44a1,1,0,0,0,0,2Z"/><path d="M54,31h2a1,1,0,0,0,0-2H54a1,1,0,0,0,0,2Z"/><path d="M70,31h2a1,1,0,0,0,0-2H70a1,1,0,0,0,0,2Z"/><path d="M78,31h2a1,1,0,0,0,0-2H78a1,1,0,0,0,0,2Z"/><path d="M69.82788,62.81238c.003-.00672.00177-.01386.00458-.02063-.00849.01971-.02106.03729-.03021.0567C69.80908,62.83484,69.82166,62.82642,69.82788,62.81238Z"/><path d="M73.76849,63.10583l-1.415-.65344a.94846.94846,0,0,0-1.27033.50763,1.0159,1.0159,0,0,0,.48859,1.32l1.41491.65344a.9485.9485,0,0,0,1.27039-.50769A1.01581,1.01581,0,0,0,73.76849,63.10583Z"/><path d="M77.23151,66.8938l1.415.65344a.94843.94843,0,0,0,1.27033-.50763,1.01593,1.01593,0,0,0-.48853-1.32l-1.415-.65344a.9485.9485,0,0,0-1.27039.50769A1.01581,1.01581,0,0,0,77.23151,66.8938Z"/><path d="M63,61H61a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M39,61H37a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M21.98669,65.06653,20.57178,65.72a1.0158,1.0158,0,0,0-.48859,1.31995.94844.94844,0,0,0,1.27033.50769l1.415-.65351a1.01579,1.01579,0,0,0,.48859-1.31994A.94847.94847,0,0,0,21.98669,65.06653Z"/><path d="M27.64648,62.4527l-1.415.65344a1.01583,1.01583,0,0,0-.48859,1.31995.9485.9485,0,0,0,1.27039.50769l1.415-.65345a1.01584,1.01584,0,0,0,.48853-1.31994A.94841.94841,0,0,0,27.64648,62.4527Z"/><path d="M46.3913,36.71094a1.05307,1.05307,0,0,0,1.40515-.38263l1.0719-1.8468a.97664.97664,0,0,0-.39685-1.35462,1.05314,1.05314,0,0,0-1.40522.38263l-1.0719,1.8468A.97657.97657,0,0,0,46.3913,36.71094Z"/><path d="M33.5285,58.87311a1.05323,1.05323,0,0,0,1.40522-.38269l1.0719-1.8468A.97662.97662,0,0,0,35.6087,55.289a1.05313,1.05313,0,0,0-1.40521.38263l-1.0719,1.84686A.97677.97677,0,0,0,33.5285,58.87311Z"/><path d="M44.18384,40.51428a1.053,1.053,0,0,0-1.40515.38257l-1.0719,1.84686a.97667.97667,0,0,0,.39691,1.35462,1.05307,1.05307,0,0,0,1.40515-.38263l1.0719-1.8468A.97654.97654,0,0,0,44.18384,40.51428Z"/><path d="M65.7959,55.67072a1.04968,1.04968,0,0,0-1.40259-.38117.97766.97766,0,0,0-.39459,1.355L65.071,58.49139a1.04976,1.04976,0,0,0,1.40259.38123.97774.97774,0,0,0,.39459-1.355Z"/><path d="M52.2041,36.32916a1.04971,1.04971,0,0,0,1.40259.38123.97758.97758,0,0,0,.39459-1.35492L52.929,33.50854a1.04973,1.04973,0,0,0-1.40259-.38116.97766.97766,0,0,0-.39459,1.355Z"/><path d="M56.4931,43.71655a1.04968,1.04968,0,0,0,1.40259.38123.97762.97762,0,0,0,.39453-1.35492L57.218,40.89594a1.04972,1.04972,0,0,0-1.40259-.38117.97776.97776,0,0,0-.39459,1.355Z"/><path d="M50,31a1.00006,1.00006,0,1,0-.70709-.29291A1.00659,1.00659,0,0,0,50,31Z"/><path d="M32,61a1.00006,1.00006,0,1,0,.70709.29291A1.00659,1.00659,0,0,0,32,61Z"/><path d="M36.73779,72.64984l1.03351,1.75977a1.07149,1.07149,0,0,0,1.427.38226.98413.98413,0,0,0,.39838-1.36938l-1.03357-1.75983a1.07152,1.07152,0,0,0-1.427-.38226A.984.984,0,0,0,36.73779,72.64984Z"/><path d="M46.03961,88.4881a1.07135,1.07135,0,0,0,1.42694.3822.98406.98406,0,0,0,.39832-1.36938L46.8313,85.74109a1.07128,1.07128,0,0,0-1.42694-.3822.984.984,0,0,0-.39832,1.36932Z"/><path d="M41.90546,81.44885a1.07141,1.07141,0,0,0,1.427.3822.98408.98408,0,0,0,.39831-1.36938L42.6972,78.70184a1.07143,1.07143,0,0,0-1.42694-.3822.98414.98414,0,0,0-.39837,1.36945Z"/><path d="M34.94843,65.50751a.98366.98366,0,0,0-.17963-.19959,1.06548,1.06548,0,0,0-1.24738-.18286.97627.97627,0,0,0-.42871,1.28009.89167.89167,0,0,0,.03021.08917l.514.87574a1.07147,1.07147,0,0,0,1.427.3825.984.984,0,0,0,.3985-1.36932Z"/><path d="M77.49731,44.73291a1.019,1.019,0,0,0,1.3852-.38654l.99731-1.76709a1.01632,1.01632,0,0,0-1.773-.994l-.99731,1.76709A1.01188,1.01188,0,0,0,77.49731,44.73291Z"/><path d="M71.51337,55.33545a1.019,1.019,0,0,0-1.38526.38653l-.99725,1.76709a1.01628,1.01628,0,0,0,1.77295.994l.99737-1.76709A1.01193,1.01193,0,0,0,71.51337,55.33545Z"/><path d="M81.48669,37.66455a1.019,1.019,0,0,0,1.3852-.3866l.99731-1.767a1.01635,1.01635,0,0,0-1.77307-.994l-.99731,1.76715A1.01189,1.01189,0,0,0,81.48669,37.66455Z"/><path d="M52.533,88.8703a1.07,1.07,0,0,0,1.42578-.38214l1.03272-1.75952a.98406.98406,0,0,0-.398-1.36908,1.07032,1.07032,0,0,0-1.42591.38214l-1.03259,1.75952A.98406.98406,0,0,0,52.533,88.8703Z"/><path d="M56.66376,81.8324a1.07019,1.07019,0,0,0,1.4259-.38214l1.03259-1.75946a.9841.9841,0,0,0-.398-1.36914,1.07013,1.07013,0,0,0-1.42578.38214l-1.03271,1.75952A.98408.98408,0,0,0,56.66376,81.8324Z"/><path d="M60.79449,74.79456a1.07033,1.07033,0,0,0,1.42591-.38221l1.03271-1.75946a.98426.98426,0,0,0-.398-1.36914,1.07032,1.07032,0,0,0-1.4259.3822l-1.03271,1.75947A.9842.9842,0,0,0,60.79449,74.79456Z"/><path d="M66.46686,65.12958A1.0702,1.0702,0,0,0,65.041,65.512l-.12415.21149-.38953.66406a.98427.98427,0,0,0,.39826,1.36908,1.07021,1.07021,0,0,0,1.42578-.38244l.39313-.67005.12054-.2055A.98416.98416,0,0,0,66.46686,65.12958Z"/><path d="M68,61a1.00006,1.00006,0,1,0,.70709.29291A1.00659,1.00659,0,0,0,68,61Z"/><path d="M50,19a1,1,0,0,0,1-1V16a1,1,0,0,0-2,0v2A1,1,0,0,0,50,19Z"/><path d="M50,27a.98588.98588,0,0,0,.95258-.765A.96109.96109,0,0,0,51,26V24a1,1,0,0,0-2,0v2A1,1,0,0,0,50,27Z"/>
                      <path d="M94.98254,15.91431a.97107.97107,0,0,0-.0238-.15686,1.01454,1.01454,0,0,0-.16821-.34961c-.01563-.02094-.02051-.04633-.038-.06629-.00769-.00873-.01867-.01184-.02649-.02026a.98715.98715,0,0,0-.08545-.07312.95865.95865,0,0,0-.13549-.09583,1.00605,1.00605,0,0,0-.094-.0589.9841.9841,0,0,0-.10864-.03228c-.02881-.00934-.05078-.02948-.08081-.03632l-44.00012-10a.98454.98454,0,0,0-.44324,0l-44,10c-.03.00684-.052.027-.08081.03632a.99725.99725,0,0,0-.10864.03228,1.00443,1.00443,0,0,0-.09424.059.96162.96162,0,0,0-.13525.0957.97371.97371,0,0,0-.08545.073c-.00794.00842-.01893.01159-.02662.02038-.01757.02-.02246.04541-.03808.06641a1.44125,1.44125,0,0,0-.13855.24237,1.15684,1.15684,0,0,0-.05335.2644c-.00268.02954-.01721.05506-.01721.08527L5,84a1.00111,1.00111,0,0,0,.47.848l16,10a.97594.97594,0,0,0,.093.04126.93961.93961,0,0,0,.09338.04138A1.00155,1.00155,0,0,0,22,95H78a1.00206,1.00206,0,0,0,.34351-.0694.94091.94091,0,0,0,.0935-.0415.99087.99087,0,0,0,.0929-.04114l16-10a1.00139,1.00139,0,0,0,.47-.848V16C94.99988,15.9696,94.98523,15.944,94.98254,15.91431ZM49,7.25275V8a1,1,0,0,0,2,0V7.25287L91.86414,16.54,77.62415,29H22.37561L8.13574,16.54ZM6.99988,83.44574V18.20361L21,30.4538V78.17773l-1.53918.48975a1,1,0,1,0,.60632,1.90582L21,80.27649V92.19586ZM77,93H23V31H49v1a1,1,0,0,0,2,0V31H77Zm16-9.55426-14,8.75V80.27661l.93262.29669a1,1,0,1,0,.60632-1.90582L79,78.1778V30.45367l14-12.25Z"/><path d="M28.61169,75.75586l-1.8302.58234a1,1,0,1,0,.60633,1.90582l1.8302-.58228a1,1,0,1,0-.60633-1.90588Z"/><path d="M43.25317,71.09729l-1.8302.58234a1,1,0,1,0,.60633,1.90582l1.8302-.58228a1,1,0,1,0-.60633-1.90588Z"/><path d="M35.9325,73.42657l-1.83021.58234a1,1,0,1,0,.60633,1.90582l1.8302-.58227a1,1,0,1,0-.60632-1.90589Z"/><path d="M13.97021,80.41443l-1.83007.58234a1,1,0,0,0,.60632,1.90588l1.83008-.58234a1,1,0,1,0-.60633-1.90588Z"/><path d="M63.46094,75.33246l1.8302.58227a1,1,0,1,0,.60632-1.90582l-1.8302-.58234a1,1,0,1,0-.60632,1.90589Z"/><path d="M70.78174,77.66174l1.8302.58228a1,1,0,1,0,.60632-1.90582l-1.8302-.58234a1,1,0,1,0-.60632,1.90588Z"/><path d="M56.14026,73.00317l1.8302.58228a1,1,0,1,0,.60632-1.90582l-1.8302-.58234a1,1,0,1,0-.60632,1.90588Z"/><path d="M85.42322,82.32031l1.8302.58234a1,1,0,0,0,.60632-1.90588l-1.8302-.58234a1,1,0,1,0-.60632,1.90588Z"/><path d="M50,17a1,1,0,0,0,1-1V14a1,1,0,0,0-2,0v2A1,1,0,0,0,50,17Z"/><path d="M50,25a1,1,0,0,0,1-1V22a1,1,0,0,0-2,0v2A1,1,0,0,0,50,25Z"/><path d="M50,37a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V38A1,1,0,0,0,50,37Z"/><path d="M50,45a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V46A1,1,0,0,0,50,45Z"/><path d="M50,61a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V62A1,1,0,0,0,50,61Z"/><path d="M50,53a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V54A1,1,0,0,0,50,53Z"/><circle cx="50" cy="70" r="1"/>
                      <path d="M34.65,50.8595a1,1,0,0,0-1.25213.65741l-.59473,1.90948a1,1,0,1,0,1.90949.59479l.59472-1.90955A1,1,0,0,0,34.65,50.8595Z"/><path d="M41.78693,27.94525a1,1,0,0,0-1.25214.65735l-.59473,1.90955a1,1,0,1,0,1.90949.59472l.59472-1.90948A.99994.99994,0,0,0,41.78693,27.94525Z"/><path d="M44.16589,20.30713a1,1,0,0,0-1.25213.65741L42.319,22.874a1,1,0,1,0,1.90949.59479l.59472-1.90954A1,1,0,0,0,44.16589,20.30713Z"/><path d="M37.029,43.22144a.99993.99993,0,0,0-1.25213.65734l-.59473,1.90955a1,1,0,1,0,1.90948.59473l.59473-1.90949A.99994.99994,0,0,0,37.029,43.22144Z"/><path d="M39.408,35.58331a1,1,0,0,0-1.25214.65741l-.59472,1.90949a1,1,0,0,0,1.90948.59479l.59473-1.90955A1,1,0,0,0,39.408,35.58331Z"/><path d="M31.08154,62.31665a.99993.99993,0,0,0,1.25214-.65741l.59473-1.90948a1,1,0,0,0-1.90949-.59479l-.59473,1.90954A1,1,0,0,0,31.08154,62.31665Z"/><path d="M59.97321,36.8222l.59246,1.91022A1,1,0,1,0,62.47589,38.14l-.59247-1.91021a1,1,0,1,0-1.91021.59246Z"/><path d="M57.60339,29.18121l.59247,1.91028a1,1,0,1,0,1.91022-.59247l-.59247-1.91021a1,1,0,1,0-1.91022.5924Z"/><path d="M55.23364,21.54028l.59241,1.91022a1,1,0,1,0,1.91022-.59241l-.59241-1.91021a1,1,0,1,0-1.91022.5924Z"/><path d="M62.343,44.46313l.5924,1.91022a1,1,0,1,0,1.91022-.59241l-.59241-1.91027a1,1,0,1,0-1.91021.59246Z"/><path d="M64.71277,52.10406l.59247,1.91022a1,1,0,1,0,1.91021-.5924L66.623,51.51166a1,1,0,1,0-1.91022.5924Z"/><path d="M67.08258,59.745l.59247,1.91027a1,1,0,0,0,1.91022-.59246l-.59247-1.91022a1,1,0,1,0-1.91022.59241Z"/><path d="M25.78,67.43353l-1.61774.93341a1,1,0,0,0,.99945,1.73236l1.61774-.93341A1,1,0,0,0,25.78,67.43353Z"/><path d="M12.83771,74.90063,11.22,75.834a1,1,0,1,0,.99945,1.73237l1.61774-.93335a1,1,0,1,0-.99945-1.73237Z"/><path d="M19.30884,71.16711l-1.61774.93335a1,1,0,0,0,.99945,1.73236l1.61774-.93341a1,1,0,1,0-.99945-1.7323Z"/><path d="M86.16266,76.633l1.61786.93335A1,1,0,0,0,88.78,75.834l-1.61786-.93335a1,1,0,1,0-.99945,1.73237Z"/><path d="M73.21991,69.16608l1.6178.93335a1,1,0,0,0,.99945-1.73236l-1.6178-.93335a1,1,0,1,0-.99945,1.73236Z"/><path d="M79.69128,72.89954l1.6178.93335a1,1,0,0,0,.99945-1.73237l-1.6178-.93334a1,1,0,0,0-.99945,1.73236Z"/><path d="M46.99994,65h-2a1,1,0,0,0,0,2h2a1,1,0,1,0,0-2Z"/><path d="M54.99994,65h-2a1,1,0,0,0,0,2h2a1,1,0,1,0,0-2Z"/><path d="M32,65H30a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M68,65a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2H68Z"/><path d="M94.86,79.49l-44-74a.99969.99969,0,0,0-1.72,0l-44,74a.96632.96632,0,0,0-.11.76.99759.99759,0,0,0,.47.61l24,14a.848.848,0,0,0,.26.11c.01,0,.01,0,.02.01.00995,0,.03-.01.04,0A1.1006,1.1006,0,0,0,30,95H70a1.1006,1.1006,0,0,0,.18-.02c.01-.01.03,0,.04,0,.01-.01.01-.01.02-.01a.848.848,0,0,0,.26-.11l24-14a.99759.99759,0,0,0,.47-.61A.96632.96632,0,0,0,94.86,79.49ZM29.33,92.45,7.37,79.64,47.62,11.96Zm1.92.55,5.90979-26h1.84015a1,1,0,1,0,0-2H37.61438L50,10.51,62.38562,65H60.99994a1,1,0,0,0,0,2h1.84027L68.75,93Zm39.42-.55L52.38,11.96,92.63,79.64Z"/>
                      <path d="M14.64832,76.29681l-1.93909.64045a1.06448,1.06448,0,0,0-.66107,1.32653,1.01051,1.01051,0,0,0,1.278.68616l1.93915-.64038a1.0645,1.0645,0,0,0,.661-1.3266A1.01052,1.01052,0,0,0,14.64832,76.29681Z"/><path d="M22.40466,73.73511l-1.93908.64044a1.0644,1.0644,0,0,0-.661,1.32654,1.01056,1.01056,0,0,0,1.278.68622l1.93909-.64045a1.06458,1.06458,0,0,0,.66107-1.3266A1.01061,1.01061,0,0,0,22.40466,73.73511Z"/><path d="M36.59528,71.26489l1.93914-.64044a1.06452,1.06452,0,0,0,.661-1.3266,1.01051,1.01051,0,0,0-1.278-.68616l-1.93909.64045a1.06448,1.06448,0,0,0-.66107,1.32653A1.01058,1.01058,0,0,0,36.59528,71.26489Z"/><path d="M28.83893,73.8266l1.93915-.64044a1.06453,1.06453,0,0,0,.661-1.3266,1.01052,1.01052,0,0,0-1.278-.68616l-1.93909.64044a1.06449,1.06449,0,0,0-.66107,1.32654A1.01055,1.01055,0,0,0,28.83893,73.8266Z"/><path d="M44.35168,68.70319l1.93909-.64045a1.06454,1.06454,0,0,0,.66107-1.32659A1.0106,1.0106,0,0,0,45.67377,66.05l-1.93909.64044a1.06445,1.06445,0,0,0-.661,1.3266A1.01052,1.01052,0,0,0,44.35168,68.70319Z"/><path d="M84.73468,78.30957l1.93909.64038a1.01055,1.01055,0,0,0,1.27807-.68616,1.06448,1.06448,0,0,0-.66107-1.32653l-1.93909-.64045a1.01052,1.01052,0,0,0-1.278.68616A1.0645,1.0645,0,0,0,84.73468,78.30957Z"/><path d="M56.26532,66.69043,54.32623,66.05a1.0106,1.0106,0,0,0-1.27807.68616,1.06454,1.06454,0,0,0,.66107,1.32659l1.93909.64045a1.01052,1.01052,0,0,0,1.278-.68616A1.06445,1.06445,0,0,0,56.26532,66.69043Z"/><path d="M64.02167,69.25214l-1.93909-.64045a1.01051,1.01051,0,0,0-1.278.68616,1.06446,1.06446,0,0,0,.661,1.3266l1.93908.64044a1.01062,1.01062,0,0,0,1.27808-.68622A1.06448,1.06448,0,0,0,64.02167,69.25214Z"/><path d="M76.97833,75.74786l1.93909.64045a1.01056,1.01056,0,0,0,1.278-.68622,1.0644,1.0644,0,0,0-.661-1.32654l-1.93908-.64044a1.01058,1.01058,0,0,0-1.27808.68615A1.06458,1.06458,0,0,0,76.97833,75.74786Z"/><path d="M71.778,71.81384l-1.93909-.64044a1.01052,1.01052,0,0,0-1.278.68616,1.06448,1.06448,0,0,0,.661,1.3266l1.93909.64044a1.01062,1.01062,0,0,0,1.27808-.68622A1.06449,1.06449,0,0,0,71.778,71.81384Z"/><path d="M50,17a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V18A1,1,0,0,0,50,17Z"/><path d="M50,9a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V10A1,1,0,0,0,50,9Z"/><path d="M50,25a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V26A1,1,0,0,0,50,25Z"/><path d="M29.293,47.95557l1.89062-.56916a.92956.92956,0,0,0,.64454-1.179,1.00418,1.00418,0,0,0-1.2461-.60986l-1.89062.56915a.92959.92959,0,0,0-.64453,1.179A1.00418,1.00418,0,0,0,29.293,47.95557Z"/><path d="M36.85547,45.679l1.89062-.56916a.92959.92959,0,0,0,.64453-1.179,1.00423,1.00423,0,0,0-1.24609-.60987l-1.89062.56916a.92965.92965,0,0,0-.64453,1.179A1.00419,1.00419,0,0,0,36.85547,45.679Z"/><path d="M44.41791,43.40234l1.89062-.56915a.92959.92959,0,0,0,.64453-1.179,1.0042,1.0042,0,0,0-1.24609-.60981l-1.89062.56916a.92956.92956,0,0,0-.64454,1.179A1.0042,1.0042,0,0,0,44.41791,43.40234Z"/><path d="M61.25391,45.1098l1.89062.56916a1.0041,1.0041,0,0,0,1.246-.60981.92958.92958,0,0,0-.64447-1.179L61.85547,43.321a1.00423,1.00423,0,0,0-1.24609.60987A.92955.92955,0,0,0,61.25391,45.1098Z"/><path d="M68.81635,47.38641l1.89062.56916a1.00418,1.00418,0,0,0,1.24609-.60987.92959.92959,0,0,0-.64453-1.179l-1.89062-.56915a1.00415,1.00415,0,0,0-1.2461.60986A.92951.92951,0,0,0,68.81635,47.38641Z"/><path d="M53.69147,42.83319l1.89062.56915a1.0042,1.0042,0,0,0,1.2461-.6098.9296.9296,0,0,0-.64454-1.179L54.293,41.04443a1.0042,1.0042,0,0,0-1.24609.60981A.92959.92959,0,0,0,53.69147,42.83319Z"/><path d="M75.2,50S94.82,20.57,94.83,20.55A.96681.96681,0,0,0,95,20a.9902.9902,0,0,0-.7-.95c-.03-.01-44-14-44-14a.88322.88322,0,0,0-.6,0s-43.97,13.99-44,14A.9902.9902,0,0,0,5,20a.96681.96681,0,0,0,.17.55C5.18,20.57,24.8,50,24.8,50S5.18,79.43,5.17,79.45A.96681.96681,0,0,0,5,80a.9902.9902,0,0,0,.7.95c.03.00995,44,14,44,14a.88393.88393,0,0,0,.6,0s43.97-13.99005,44-14A.9902.9902,0,0,0,95,80a.96681.96681,0,0,0-.17-.55C94.82,79.43,75.2,50,75.2,50Zm-1.84-.85L51,56.27V34.73L91.59,21.82ZM49,92.63,7.57,79.45,26.41,51.18,49,58.37Zm0-36.36L26.64,49.15,8.41,21.82,49,34.73ZM50,32.95,9.3,20,50,7.05,90.7,20Zm1,59.68V58.37l22.59-7.19L92.43,79.45Z"/>
                      </svg>
                      """
                  )
                ),
                [1]: CKRecord(
                  recordID: CKRecord.ID(1:remindersLists/zone/__defaultOwner__),
                  recordType: "remindersLists",
                  parent: nil,
                  share: nil,
                  id: 1,
                  title: "Personal"
                )
              ]
            ),
            sharedCloudDatabase: MockCloudDatabase(
              databaseScope: .shared,
              storage: []
            )
          )
          """#
        }

        inMemoryDataManager.storage.withValue { storage in
          let url = URL(
            string: "file:///fb007a3c86694eb9c1122a4af617772e2396d8b093fd6e79981bff2221d78874"
          )!
          #expect(storage[url] == blackCoverImage)
        }

        let redImageURL = Bundle.module.url(forResource: "test-red", withExtension: "svg")!
        let redCoverImage = try Data(contentsOf: redImageURL)
        
        try await withDependencies {
          $0.currentTime.now += 1
        } operation: {
          try await userDatabase.userWrite { db in
            try RemindersListAsset
              .find(1)
              .update { $0.coverImage = redCoverImage }
              .execute(db)
          }
        }

        try await syncEngine.processPendingRecordZoneChanges(scope: .private)

        assertInlineSnapshot(of: container, as: .customDump) {
          #"""
          MockCloudContainer(
            privateCloudDatabase: MockCloudDatabase(
              databaseScope: .private,
              storage: [
                [0]: CKRecord(
                  recordID: CKRecord.ID(1:remindersListAssets/zone/__defaultOwner__),
                  recordType: "remindersListAssets",
                  parent: CKReference(recordID: CKRecord.ID(1:remindersLists/zone/__defaultOwner__)),
                  share: nil,
                  coverImage_hash: Data(32 bytes),
                  remindersListID: 1,
                  coverImage: CKAsset(
                    fileURL: URL(file:///944321b4de38bc7785f6941a4adf4c0fbd370ed4c0e9746327d1a17f4031ba60),
                    dataString: """
                      <?xml version="1.0" ?>
                      <svg fill="#ff0000" width="800px" height="800px" viewBox="0 0 100 100" data-name="Layer 1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"><title/><path d="M86.99872,29.9895c-.00012-.01105-.0036-.02167-.00409-.03277a.99019.99019,0,0,0-.07178-.32221c-.00525-.01337-.00317-.0274-.009-.04065-.0036-.00812-.011-.01282-.01477-.02075a.9917.9917,0,0,0-.19812-.27911c-.018-.01789-.037-.03217-.05628-.04853a.98559.98559,0,0,0-.09-.07757l-36-24a.99857.99857,0,0,0-1.10938,0l-36,24a.98559.98559,0,0,0-.09.07757c-.01923.01636-.03827.03064-.05628.04853a.9917.9917,0,0,0-.19812.27911c-.00378.00793-.01117.01263-.01477.02075-.00586.01325-.00378.02728-.009.04065a.98747.98747,0,0,0-.07178.32239c-.00049.011-.004.02167-.00409.03265L13,30V70l.00073.0061c.00012.01465.0047.029.00543.04364a.99889.99889,0,0,0,.02832.20569c.00672.02533.01978.04859.02845.07343a1.00245,1.00245,0,0,0,.06683.15918l.007.01678c.01392.02381.0343.04187.05.06421a.98612.98612,0,0,0,.09454.12152,1.00707,1.00707,0,0,0,.08124.07007.97232.97232,0,0,0,.08276.07141l36,24a.9775.9775,0,0,0,.109.05127.95424.95424,0,0,0,.09924.04669.98514.98514,0,0,0,.693,0,.95424.95424,0,0,0,.09924-.04669.9775.9775,0,0,0,.109-.05127l36-24a463.02063,463.02063,0,0,1,.16607-.14325.994.994,0,0,0,.092-.119c.01624-.02313.037-.04187.05146-.06659l.00671-.01611a.99256.99256,0,0,0,.06415-.15308c.01-.02771.02447-.054.03186-.08227a1.00828,1.00828,0,0,0,.0202-.148.98466.98466,0,0,0,.01276-.103L87,70V30Zm-3.06525-.16534L68.30084,36.772l-3.47748-6.23736A.97217.97217,0,0,0,65,30a1,1,0,0,0-1-1h-.03217L52.88849,9.1275Zm-33.7771-21.49,11.5542,20.72424A.988.988,0,0,0,61,30a1,1,0,0,0,1,1h.793l3.34515,6H33.72583l3.439-6H38a1,1,0,0,0,1-1,.98727.98727,0,0,0-.721-.94373Zm-2.58374.4859L36.00592,29H36a1,1,0,0,0-1,1,.97236.97236,0,0,0,.14941.49432l-3.56817,6.22522L16.06653,29.82416ZM15,31.53876l15.58966,6.92877-5.454,9.696a.99806.99806,0,0,0-.63824.10352,1.01187,1.01187,0,0,0-.38788,1.38049l.09582.1698L15,66.18243Zm10.41705,20.204a1.01014,1.01014,0,0,0,1.46283-1.32208l-.36017-.63819L32,40.03973l5.54987,9.8664-.13062.225a.9766.9766,0,0,0,.39685,1.35462,1.04677,1.04677,0,0,0,.67731.09784l5.61523,9.9826A.97983.97983,0,0,0,44,62a.9906.9906,0,0,0,.9043.98065L48.29016,69H15.70984ZM49,92.13141,17.30286,71H49Zm1-24.17114-2.81152-4.99836A.986.986,0,0,0,48,62a1,1,0,0,0-1-1h-.91516L39.87976,49.96863l.41345-.7124a.97673.97673,0,0,0-.39691-1.35462,1.06368,1.06368,0,0,0-1.13385.08069L33.7099,39H66.29016l-5.05261,8.98242a1.06,1.06,0,0,0-1.13324-.08026.97769.97769,0,0,0-.39453,1.355l.4118.70923L53.91516,61H53a1,1,0,0,0-1,1,.98611.98611,0,0,0,.81158.962Zm1,24.17114V71H82.69714ZM51.70984,69l3.38586-6.01935A.99065.99065,0,0,0,56,62a.98.98,0,0,0-.10864-.43384l5.61523-9.9826a1.04291,1.04291,0,0,0,.678-.09839.97774.97774,0,0,0,.39459-1.355l-.12957-.22315,5.47308-9.72992,5.50494,9.69867-.30755.54493A1.00341,1.00341,0,0,0,74.50854,51.78L84.28253,69ZM85,66.21234,75.74463,49.90619l.14593-.25861A1.00958,1.00958,0,0,0,74.76031,48.172l-5.47637-9.64832L85,31.53876Z"/><path d="M21.89319,41.58527a1.01632,1.01632,0,0,0-1.773.994l.99725,1.76709a1.01635,1.01635,0,0,0,1.77307-.994Z"/><path d="M29.87183,55.722a1.01628,1.01628,0,0,0-1.77295.994l.99725,1.76709a1.01633,1.01633,0,0,0,1.77307-.994Z"/><path d="M17.90387,34.51691a1.01635,1.01635,0,0,0-1.77307.994l.99731,1.767a1.01632,1.01632,0,0,0,1.77307-.99389Z"/><path d="M30,29H28a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M22,29H20a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M44,31h2a1,1,0,0,0,0-2H44a1,1,0,0,0,0,2Z"/><path d="M54,31h2a1,1,0,0,0,0-2H54a1,1,0,0,0,0,2Z"/><path d="M70,31h2a1,1,0,0,0,0-2H70a1,1,0,0,0,0,2Z"/><path d="M78,31h2a1,1,0,0,0,0-2H78a1,1,0,0,0,0,2Z"/><path d="M69.82788,62.81238c.003-.00672.00177-.01386.00458-.02063-.00849.01971-.02106.03729-.03021.0567C69.80908,62.83484,69.82166,62.82642,69.82788,62.81238Z"/><path d="M73.76849,63.10583l-1.415-.65344a.94846.94846,0,0,0-1.27033.50763,1.0159,1.0159,0,0,0,.48859,1.32l1.41491.65344a.9485.9485,0,0,0,1.27039-.50769A1.01581,1.01581,0,0,0,73.76849,63.10583Z"/><path d="M77.23151,66.8938l1.415.65344a.94843.94843,0,0,0,1.27033-.50763,1.01593,1.01593,0,0,0-.48853-1.32l-1.415-.65344a.9485.9485,0,0,0-1.27039.50769A1.01581,1.01581,0,0,0,77.23151,66.8938Z"/><path d="M63,61H61a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M39,61H37a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M21.98669,65.06653,20.57178,65.72a1.0158,1.0158,0,0,0-.48859,1.31995.94844.94844,0,0,0,1.27033.50769l1.415-.65351a1.01579,1.01579,0,0,0,.48859-1.31994A.94847.94847,0,0,0,21.98669,65.06653Z"/><path d="M27.64648,62.4527l-1.415.65344a1.01583,1.01583,0,0,0-.48859,1.31995.9485.9485,0,0,0,1.27039.50769l1.415-.65345a1.01584,1.01584,0,0,0,.48853-1.31994A.94841.94841,0,0,0,27.64648,62.4527Z"/><path d="M46.3913,36.71094a1.05307,1.05307,0,0,0,1.40515-.38263l1.0719-1.8468a.97664.97664,0,0,0-.39685-1.35462,1.05314,1.05314,0,0,0-1.40522.38263l-1.0719,1.8468A.97657.97657,0,0,0,46.3913,36.71094Z"/><path d="M33.5285,58.87311a1.05323,1.05323,0,0,0,1.40522-.38269l1.0719-1.8468A.97662.97662,0,0,0,35.6087,55.289a1.05313,1.05313,0,0,0-1.40521.38263l-1.0719,1.84686A.97677.97677,0,0,0,33.5285,58.87311Z"/><path d="M44.18384,40.51428a1.053,1.053,0,0,0-1.40515.38257l-1.0719,1.84686a.97667.97667,0,0,0,.39691,1.35462,1.05307,1.05307,0,0,0,1.40515-.38263l1.0719-1.8468A.97654.97654,0,0,0,44.18384,40.51428Z"/><path d="M65.7959,55.67072a1.04968,1.04968,0,0,0-1.40259-.38117.97766.97766,0,0,0-.39459,1.355L65.071,58.49139a1.04976,1.04976,0,0,0,1.40259.38123.97774.97774,0,0,0,.39459-1.355Z"/><path d="M52.2041,36.32916a1.04971,1.04971,0,0,0,1.40259.38123.97758.97758,0,0,0,.39459-1.35492L52.929,33.50854a1.04973,1.04973,0,0,0-1.40259-.38116.97766.97766,0,0,0-.39459,1.355Z"/><path d="M56.4931,43.71655a1.04968,1.04968,0,0,0,1.40259.38123.97762.97762,0,0,0,.39453-1.35492L57.218,40.89594a1.04972,1.04972,0,0,0-1.40259-.38117.97776.97776,0,0,0-.39459,1.355Z"/><path d="M50,31a1.00006,1.00006,0,1,0-.70709-.29291A1.00659,1.00659,0,0,0,50,31Z"/><path d="M32,61a1.00006,1.00006,0,1,0,.70709.29291A1.00659,1.00659,0,0,0,32,61Z"/><path d="M36.73779,72.64984l1.03351,1.75977a1.07149,1.07149,0,0,0,1.427.38226.98413.98413,0,0,0,.39838-1.36938l-1.03357-1.75983a1.07152,1.07152,0,0,0-1.427-.38226A.984.984,0,0,0,36.73779,72.64984Z"/><path d="M46.03961,88.4881a1.07135,1.07135,0,0,0,1.42694.3822.98406.98406,0,0,0,.39832-1.36938L46.8313,85.74109a1.07128,1.07128,0,0,0-1.42694-.3822.984.984,0,0,0-.39832,1.36932Z"/><path d="M41.90546,81.44885a1.07141,1.07141,0,0,0,1.427.3822.98408.98408,0,0,0,.39831-1.36938L42.6972,78.70184a1.07143,1.07143,0,0,0-1.42694-.3822.98414.98414,0,0,0-.39837,1.36945Z"/><path d="M34.94843,65.50751a.98366.98366,0,0,0-.17963-.19959,1.06548,1.06548,0,0,0-1.24738-.18286.97627.97627,0,0,0-.42871,1.28009.89167.89167,0,0,0,.03021.08917l.514.87574a1.07147,1.07147,0,0,0,1.427.3825.984.984,0,0,0,.3985-1.36932Z"/><path d="M77.49731,44.73291a1.019,1.019,0,0,0,1.3852-.38654l.99731-1.76709a1.01632,1.01632,0,0,0-1.773-.994l-.99731,1.76709A1.01188,1.01188,0,0,0,77.49731,44.73291Z"/><path d="M71.51337,55.33545a1.019,1.019,0,0,0-1.38526.38653l-.99725,1.76709a1.01628,1.01628,0,0,0,1.77295.994l.99737-1.76709A1.01193,1.01193,0,0,0,71.51337,55.33545Z"/><path d="M81.48669,37.66455a1.019,1.019,0,0,0,1.3852-.3866l.99731-1.767a1.01635,1.01635,0,0,0-1.77307-.994l-.99731,1.76715A1.01189,1.01189,0,0,0,81.48669,37.66455Z"/><path d="M52.533,88.8703a1.07,1.07,0,0,0,1.42578-.38214l1.03272-1.75952a.98406.98406,0,0,0-.398-1.36908,1.07032,1.07032,0,0,0-1.42591.38214l-1.03259,1.75952A.98406.98406,0,0,0,52.533,88.8703Z"/><path d="M56.66376,81.8324a1.07019,1.07019,0,0,0,1.4259-.38214l1.03259-1.75946a.9841.9841,0,0,0-.398-1.36914,1.07013,1.07013,0,0,0-1.42578.38214l-1.03271,1.75952A.98408.98408,0,0,0,56.66376,81.8324Z"/><path d="M60.79449,74.79456a1.07033,1.07033,0,0,0,1.42591-.38221l1.03271-1.75946a.98426.98426,0,0,0-.398-1.36914,1.07032,1.07032,0,0,0-1.4259.3822l-1.03271,1.75947A.9842.9842,0,0,0,60.79449,74.79456Z"/><path d="M66.46686,65.12958A1.0702,1.0702,0,0,0,65.041,65.512l-.12415.21149-.38953.66406a.98427.98427,0,0,0,.39826,1.36908,1.07021,1.07021,0,0,0,1.42578-.38244l.39313-.67005.12054-.2055A.98416.98416,0,0,0,66.46686,65.12958Z"/><path d="M68,61a1.00006,1.00006,0,1,0,.70709.29291A1.00659,1.00659,0,0,0,68,61Z"/><path d="M50,19a1,1,0,0,0,1-1V16a1,1,0,0,0-2,0v2A1,1,0,0,0,50,19Z"/><path d="M50,27a.98588.98588,0,0,0,.95258-.765A.96109.96109,0,0,0,51,26V24a1,1,0,0,0-2,0v2A1,1,0,0,0,50,27Z"/>
                      <path d="M94.98254,15.91431a.97107.97107,0,0,0-.0238-.15686,1.01454,1.01454,0,0,0-.16821-.34961c-.01563-.02094-.02051-.04633-.038-.06629-.00769-.00873-.01867-.01184-.02649-.02026a.98715.98715,0,0,0-.08545-.07312.95865.95865,0,0,0-.13549-.09583,1.00605,1.00605,0,0,0-.094-.0589.9841.9841,0,0,0-.10864-.03228c-.02881-.00934-.05078-.02948-.08081-.03632l-44.00012-10a.98454.98454,0,0,0-.44324,0l-44,10c-.03.00684-.052.027-.08081.03632a.99725.99725,0,0,0-.10864.03228,1.00443,1.00443,0,0,0-.09424.059.96162.96162,0,0,0-.13525.0957.97371.97371,0,0,0-.08545.073c-.00794.00842-.01893.01159-.02662.02038-.01757.02-.02246.04541-.03808.06641a1.44125,1.44125,0,0,0-.13855.24237,1.15684,1.15684,0,0,0-.05335.2644c-.00268.02954-.01721.05506-.01721.08527L5,84a1.00111,1.00111,0,0,0,.47.848l16,10a.97594.97594,0,0,0,.093.04126.93961.93961,0,0,0,.09338.04138A1.00155,1.00155,0,0,0,22,95H78a1.00206,1.00206,0,0,0,.34351-.0694.94091.94091,0,0,0,.0935-.0415.99087.99087,0,0,0,.0929-.04114l16-10a1.00139,1.00139,0,0,0,.47-.848V16C94.99988,15.9696,94.98523,15.944,94.98254,15.91431ZM49,7.25275V8a1,1,0,0,0,2,0V7.25287L91.86414,16.54,77.62415,29H22.37561L8.13574,16.54ZM6.99988,83.44574V18.20361L21,30.4538V78.17773l-1.53918.48975a1,1,0,1,0,.60632,1.90582L21,80.27649V92.19586ZM77,93H23V31H49v1a1,1,0,0,0,2,0V31H77Zm16-9.55426-14,8.75V80.27661l.93262.29669a1,1,0,1,0,.60632-1.90582L79,78.1778V30.45367l14-12.25Z"/><path d="M28.61169,75.75586l-1.8302.58234a1,1,0,1,0,.60633,1.90582l1.8302-.58228a1,1,0,1,0-.60633-1.90588Z"/><path d="M43.25317,71.09729l-1.8302.58234a1,1,0,1,0,.60633,1.90582l1.8302-.58228a1,1,0,1,0-.60633-1.90588Z"/><path d="M35.9325,73.42657l-1.83021.58234a1,1,0,1,0,.60633,1.90582l1.8302-.58227a1,1,0,1,0-.60632-1.90589Z"/><path d="M13.97021,80.41443l-1.83007.58234a1,1,0,0,0,.60632,1.90588l1.83008-.58234a1,1,0,1,0-.60633-1.90588Z"/><path d="M63.46094,75.33246l1.8302.58227a1,1,0,1,0,.60632-1.90582l-1.8302-.58234a1,1,0,1,0-.60632,1.90589Z"/><path d="M70.78174,77.66174l1.8302.58228a1,1,0,1,0,.60632-1.90582l-1.8302-.58234a1,1,0,1,0-.60632,1.90588Z"/><path d="M56.14026,73.00317l1.8302.58228a1,1,0,1,0,.60632-1.90582l-1.8302-.58234a1,1,0,1,0-.60632,1.90588Z"/><path d="M85.42322,82.32031l1.8302.58234a1,1,0,0,0,.60632-1.90588l-1.8302-.58234a1,1,0,1,0-.60632,1.90588Z"/><path d="M50,17a1,1,0,0,0,1-1V14a1,1,0,0,0-2,0v2A1,1,0,0,0,50,17Z"/><path d="M50,25a1,1,0,0,0,1-1V22a1,1,0,0,0-2,0v2A1,1,0,0,0,50,25Z"/><path d="M50,37a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V38A1,1,0,0,0,50,37Z"/><path d="M50,45a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V46A1,1,0,0,0,50,45Z"/><path d="M50,61a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V62A1,1,0,0,0,50,61Z"/><path d="M50,53a.99993.99993,0,0,0-1,1v2a1,1,0,0,0,2,0V54A1,1,0,0,0,50,53Z"/><circle cx="50" cy="70" r="1"/>
                      <path d="M34.65,50.8595a1,1,0,0,0-1.25213.65741l-.59473,1.90948a1,1,0,1,0,1.90949.59479l.59472-1.90955A1,1,0,0,0,34.65,50.8595Z"/><path d="M41.78693,27.94525a1,1,0,0,0-1.25214.65735l-.59473,1.90955a1,1,0,1,0,1.90949.59472l.59472-1.90948A.99994.99994,0,0,0,41.78693,27.94525Z"/><path d="M44.16589,20.30713a1,1,0,0,0-1.25213.65741L42.319,22.874a1,1,0,1,0,1.90949.59479l.59472-1.90954A1,1,0,0,0,44.16589,20.30713Z"/><path d="M37.029,43.22144a.99993.99993,0,0,0-1.25213.65734l-.59473,1.90955a1,1,0,1,0,1.90948.59473l.59473-1.90949A.99994.99994,0,0,0,37.029,43.22144Z"/><path d="M39.408,35.58331a1,1,0,0,0-1.25214.65741l-.59472,1.90949a1,1,0,0,0,1.90948.59479l.59473-1.90955A1,1,0,0,0,39.408,35.58331Z"/><path d="M31.08154,62.31665a.99993.99993,0,0,0,1.25214-.65741l.59473-1.90948a1,1,0,0,0-1.90949-.59479l-.59473,1.90954A1,1,0,0,0,31.08154,62.31665Z"/><path d="M59.97321,36.8222l.59246,1.91022A1,1,0,1,0,62.47589,38.14l-.59247-1.91021a1,1,0,1,0-1.91021.59246Z"/><path d="M57.60339,29.18121l.59247,1.91028a1,1,0,1,0,1.91022-.59247l-.59247-1.91021a1,1,0,1,0-1.91022.5924Z"/><path d="M55.23364,21.54028l.59241,1.91022a1,1,0,1,0,1.91022-.59241l-.59241-1.91021a1,1,0,1,0-1.91022.5924Z"/><path d="M62.343,44.46313l.5924,1.91022a1,1,0,1,0,1.91022-.59241l-.59241-1.91027a1,1,0,1,0-1.91021.59246Z"/><path d="M64.71277,52.10406l.59247,1.91022a1,1,0,1,0,1.91021-.5924L66.623,51.51166a1,1,0,1,0-1.91022.5924Z"/><path d="M67.08258,59.745l.59247,1.91027a1,1,0,0,0,1.91022-.59246l-.59247-1.91022a1,1,0,1,0-1.91022.59241Z"/><path d="M25.78,67.43353l-1.61774.93341a1,1,0,0,0,.99945,1.73236l1.61774-.93341A1,1,0,0,0,25.78,67.43353Z"/><path d="M12.83771,74.90063,11.22,75.834a1,1,0,1,0,.99945,1.73237l1.61774-.93335a1,1,0,1,0-.99945-1.73237Z"/><path d="M19.30884,71.16711l-1.61774.93335a1,1,0,0,0,.99945,1.73236l1.61774-.93341a1,1,0,1,0-.99945-1.7323Z"/><path d="M86.16266,76.633l1.61786.93335A1,1,0,0,0,88.78,75.834l-1.61786-.93335a1,1,0,1,0-.99945,1.73237Z"/><path d="M73.21991,69.16608l1.6178.93335a1,1,0,0,0,.99945-1.73236l-1.6178-.93335a1,1,0,1,0-.99945,1.73236Z"/><path d="M79.69128,72.89954l1.6178.93335a1,1,0,0,0,.99945-1.73237l-1.6178-.93334a1,1,0,0,0-.99945,1.73236Z"/><path d="M46.99994,65h-2a1,1,0,0,0,0,2h2a1,1,0,1,0,0-2Z"/><path d="M54.99994,65h-2a1,1,0,0,0,0,2h2a1,1,0,1,0,0-2Z"/><path d="M32,65H30a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2Z"/><path d="M68,65a1,1,0,0,0,0,2h2a1,1,0,0,0,0-2H68Z"/><path d="M94.86,79.49l-44-74a.99969.99969,0,0,0-1.72,0l-44,74a.96632.96632,0,0,0-.11.76.99759.99759,0,0,0,.47.61l24,14a.848.848,0,0,0,.26.11c.01,0,.01,0,.02.01.00995,0,.03-.01.04,0A1.1006,1.1006,0,0,0,30,95H70a1.1006,1.1006,0,0,0,.18-.02c.01-.01.03,0,.04,0,.01-.01.01-.01.02-.01a.848.848,0,0,0,.26-.11l24-14a.99759.99759,0,0,0,.47-.61A.96632.96632,0,0,0,94.86,79.49ZM29.33,92.45,7.37,79.64,47.62,11.96Zm1.92.55,5.90979-26h1.84015a1,1,0,1,0,0-2H37.61438L50,10.51,62.38562,65H60.99994a1,1,0,0,0,0,2h1.84027L68.75,93Zm39.42-.55L52.38,11.96,92.63,79.64Z"/>
                      <path d="M14.64832,76.29681l-1.93909.64045a1.06448,1.06448,0,0,0-.66107,1.32653,1.01051,1.01051,0,0,0,1.278.68616l1.93915-.64038a1.0645,1.0645,0,0,0,.661-1.3266A1.01052,1.01052,0,0,0,14.64832,76.29681Z"/><path d="M22.40466,73.73511l-1.93908.64044a1.0644,1.0644,0,0,0-.661,1.32654,1.01056,1.01056,0,0,0,1.278.68622l1.93909-.64045a1.06458,1.06458,0,0,0,.66107-1.3266A1.01061,1.01061,0,0,0,22.40466,73.73511Z"/><path d="M36.59528,71.26489l1.93914-.64044a1.06452,1.06452,0,0,0,.661-1.3266,1.01051,1.01051,0,0,0-1.278-.68616l-1.93909.64045a1.06448,1.06448,0,0,0-.66107,1.32653A1.01058,1.01058,0,0,0,36.59528,71.26489Z"/><path d="M28.83893,73.8266l1.93915-.64044a1.06453,1.06453,0,0,0,.661-1.3266,1.01052,1.01052,0,0,0-1.278-.68616l-1.93909.64044a1.06449,1.06449,0,0,0-.66107,1.32654A1.01055,1.01055,0,0,0,28.83893,73.8266Z"/><path d="M44.35168,68.70319l1.93909-.64045a1.06454,1.06454,0,0,0,.66107-1.32659A1.0106,1.0106,0,0,0,45.67377,66.05l-1.93909.64044a1.06445,1.06445,0,0,0-.661,1.3266A1.01052,1.01052,0,0,0,44.35168,68.70319Z"/><path d="M84.73468,78.30957l1.93909.64038a1.01055,1.01055,0,0,0,1.27807-.68616,1.06448,1.06448,0,0,0-.66107-1.32653l-1.93909-.64045a1.01052,1.01052,0,0,0-1.278.68616A1.0645,1.0645,0,0,0,84.73468,78.30957Z"/><path d="M56.26532,66.69043,54.32623,66.05a1.0106,1.0106,0,0,0-1.27807.68616,1.06454,1.06454,0,0,0,.66107,1.32659l1.93909.64045a1.01052,1.01052,0,0,0,1.278-.68616A1.06445,1.06445,0,0,0,56.26532,66.69043Z"/><path d="M64.02167,69.25214l-1.93909-.64045a1.01051,1.01051,0,0,0-1.278.68616,1.06446,1.06446,0,0,0,.661,1.3266l1.93908.64044a1.01062,1.01062,0,0,0,1.27808-.68622A1.06448,1.06448,0,0,0,64.02167,69.25214Z"/><path d="M76.97833,75.74786l1.93909.64045a1.01056,1.01056,0,0,0,1.278-.68622,1.0644,1.0644,0,0,0-.661-1.32654l-1.93908-.64044a1.01058,1.01058,0,0,0-1.27808.68615A1.06458,1.06458,0,0,0,76.97833,75.74786Z"/><path d="M71.778,71.81384l-1.93909-.64044a1.01052,1.01052,0,0,0-1.278.68616,1.06448,1.06448,0,0,0,.661,1.3266l1.93909.64044a1.01062,1.01062,0,0,0,1.27808-.68622A1.06449,1.06449,0,0,0,71.778,71.81384Z"/><path d="M50,17a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V18A1,1,0,0,0,50,17Z"/><path d="M50,9a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V10A1,1,0,0,0,50,9Z"/><path d="M50,25a1,1,0,0,0-1,1v2a1,1,0,0,0,2,0V26A1,1,0,0,0,50,25Z"/><path d="M29.293,47.95557l1.89062-.56916a.92956.92956,0,0,0,.64454-1.179,1.00418,1.00418,0,0,0-1.2461-.60986l-1.89062.56915a.92959.92959,0,0,0-.64453,1.179A1.00418,1.00418,0,0,0,29.293,47.95557Z"/><path d="M36.85547,45.679l1.89062-.56916a.92959.92959,0,0,0,.64453-1.179,1.00423,1.00423,0,0,0-1.24609-.60987l-1.89062.56916a.92965.92965,0,0,0-.64453,1.179A1.00419,1.00419,0,0,0,36.85547,45.679Z"/><path d="M44.41791,43.40234l1.89062-.56915a.92959.92959,0,0,0,.64453-1.179,1.0042,1.0042,0,0,0-1.24609-.60981l-1.89062.56916a.92956.92956,0,0,0-.64454,1.179A1.0042,1.0042,0,0,0,44.41791,43.40234Z"/><path d="M61.25391,45.1098l1.89062.56916a1.0041,1.0041,0,0,0,1.246-.60981.92958.92958,0,0,0-.64447-1.179L61.85547,43.321a1.00423,1.00423,0,0,0-1.24609.60987A.92955.92955,0,0,0,61.25391,45.1098Z"/><path d="M68.81635,47.38641l1.89062.56916a1.00418,1.00418,0,0,0,1.24609-.60987.92959.92959,0,0,0-.64453-1.179l-1.89062-.56915a1.00415,1.00415,0,0,0-1.2461.60986A.92951.92951,0,0,0,68.81635,47.38641Z"/><path d="M53.69147,42.83319l1.89062.56915a1.0042,1.0042,0,0,0,1.2461-.6098.9296.9296,0,0,0-.64454-1.179L54.293,41.04443a1.0042,1.0042,0,0,0-1.24609.60981A.92959.92959,0,0,0,53.69147,42.83319Z"/><path d="M75.2,50S94.82,20.57,94.83,20.55A.96681.96681,0,0,0,95,20a.9902.9902,0,0,0-.7-.95c-.03-.01-44-14-44-14a.88322.88322,0,0,0-.6,0s-43.97,13.99-44,14A.9902.9902,0,0,0,5,20a.96681.96681,0,0,0,.17.55C5.18,20.57,24.8,50,24.8,50S5.18,79.43,5.17,79.45A.96681.96681,0,0,0,5,80a.9902.9902,0,0,0,.7.95c.03.00995,44,14,44,14a.88393.88393,0,0,0,.6,0s43.97-13.99005,44-14A.9902.9902,0,0,0,95,80a.96681.96681,0,0,0-.17-.55C94.82,79.43,75.2,50,75.2,50Zm-1.84-.85L51,56.27V34.73L91.59,21.82ZM49,92.63,7.57,79.45,26.41,51.18,49,58.37Zm0-36.36L26.64,49.15,8.41,21.82,49,34.73ZM50,32.95,9.3,20,50,7.05,90.7,20Zm1,59.68V58.37l22.59-7.19L92.43,79.45Z"/>
                      </svg>
                      """
                  )
                ),
                [1]: CKRecord(
                  recordID: CKRecord.ID(1:remindersLists/zone/__defaultOwner__),
                  recordType: "remindersLists",
                  parent: nil,
                  share: nil,
                  id: 1,
                  title: "Personal"
                )
              ]
            ),
            sharedCloudDatabase: MockCloudDatabase(
              databaseScope: .shared,
              storage: []
            )
          )
          """#
        }

        inMemoryDataManager.storage.withValue { storage in
          let url = URL(
            string: "file:///944321b4de38bc7785f6941a4adf4c0fbd370ed4c0e9746327d1a17f4031ba60"
          )!
          #expect(storage[url] == redCoverImage)
        }
      }

      // * Receive record with CKAsset from CloudKit
      // => Stored in database as bytes
      @available(iOS 17, macOS 14, tvOS 17, watchOS 10, *)
      @Test func receiveAsset() async throws {
        let blackImageURL = Bundle.module.url(forResource: "test-black", withExtension: "svg")!
        let blackCoverImage = try Data(contentsOf: blackImageURL)
        let remindersListRecord = CKRecord(
          recordType: RemindersList.tableName,
          recordID: RemindersList.recordID(for: 1)
        )
        remindersListRecord.setValue("1", forKey: "id", at: now)
        remindersListRecord.setValue("Personal", forKey: "title", at: now)

        let fileURL = URL(fileURLWithPath: UUID().uuidString)
        try inMemoryDataManager.save(blackCoverImage, to: fileURL)
        let remindersListAssetRecord = CKRecord(
          recordType: RemindersListAsset.tableName,
          recordID: RemindersListAsset.recordID(for: 1)
        )
        remindersListAssetRecord.setValue("1", forKey: "id", at: now)
        remindersListAssetRecord.setAsset(CKAsset(fileURL: fileURL), forKey: "coverImage", at: now)
        remindersListAssetRecord.setValue("1", forKey: "remindersListID", at: now)
        remindersListAssetRecord.parent = CKRecord.Reference(
          record: remindersListRecord,
          action: .none
        )

        try await syncEngine.modifyRecords(
          scope: .private,
          saving: [remindersListAssetRecord, remindersListRecord]
        )
        .notify()

        try await userDatabase.read { db in
          let remindersListAsset = try #require(
            try RemindersListAsset.find(1).fetchOne(db)
          )
          #expect(remindersListAsset.coverImage == blackCoverImage)
        }
      }

      // * Receive record with CKAsset from CloudKit when local asset exists
      // => Stored in database as bytes
      @available(iOS 17, macOS 14, tvOS 17, watchOS 10, *)
      @Test func receiveUpdatedAsset() async throws {
        let blackImageURL = Bundle.module.url(forResource: "test-black", withExtension: "svg")!
        let blackCoverImage = try Data(contentsOf: blackImageURL)
        try await userDatabase.userWrite { db in
          try db.seed {
            RemindersList(id: 1, title: "Personal")
            RemindersListAsset(remindersListID: 1, coverImage: blackCoverImage)
          }
        }
        try await syncEngine.processPendingRecordZoneChanges(scope: .private)

        let redImageURL = Bundle.module.url(forResource: "test-red", withExtension: "svg")!
        let redCoverImage = try Data(contentsOf: redImageURL)
        try await withDependencies {
          $0.currentTime.now += 1
        } operation: {
          let fileURL = URL(fileURLWithPath: UUID().uuidString)
          try inMemoryDataManager.save(redCoverImage, to: fileURL)
          let remindersListAssetRecord = try syncEngine.private.database.record(
            for: RemindersListAsset.recordID(for: 1)
          )
          remindersListAssetRecord.setAsset(
            CKAsset(fileURL: fileURL),
            forKey: "coverImage",
            at: now
          )
          try await syncEngine.modifyRecords(
            scope: .private,
            saving: [remindersListAssetRecord]
          )
          .notify()
        }

        try await userDatabase.read { db in
          let remindersListAsset = try #require(
            try RemindersListAsset.find(1).fetchOne(db)
          )
          #expect(remindersListAsset.coverImage == redCoverImage)
        }
      }

      // * Receive record with CKAsset from CloudKit when local asset does not exist
      // * Receive updated asset from CloudKit
      // => Local database has freshest asset
      @available(iOS 17, macOS 14, tvOS 17, watchOS 10, *)
      @Test func receiveAssetThenReceiveUpdate() async throws {
        do {
          let blackImageURL = Bundle.module.url(forResource: "test-black", withExtension: "svg")!
          let blackCoverImage = try Data(contentsOf: blackImageURL)
          let remindersListRecord = CKRecord(
            recordType: RemindersList.tableName,
            recordID: RemindersList.recordID(for: 1)
          )
          remindersListRecord.setValue("1", forKey: "id", at: now)
          remindersListRecord.setValue("Personal", forKey: "title", at: now)

          let fileURL = URL(fileURLWithPath: UUID().uuidString)
          try inMemoryDataManager.save(blackCoverImage, to: fileURL)
          let remindersListAssetRecord = CKRecord(
            recordType: RemindersListAsset.tableName,
            recordID: RemindersListAsset.recordID(for: 1)
          )
          remindersListAssetRecord.setValue("1", forKey: "id", at: now)
          remindersListAssetRecord.setAsset(
            CKAsset(fileURL: fileURL),
            forKey: "coverImage",
            at: now
          )
          remindersListAssetRecord.setValue("1", forKey: "remindersListID", at: now)
          remindersListAssetRecord.parent = CKRecord.Reference(
            record: remindersListRecord,
            action: .none
          )

          try await syncEngine.modifyRecords(
            scope: .private,
            saving: [remindersListAssetRecord, remindersListRecord]
          )
          .notify()
        }

        let redImageURL = Bundle.module.url(forResource: "test-red", withExtension: "svg")!
        let redCoverImage = try Data(contentsOf: redImageURL)
        try await withDependencies {
          $0.currentTime.now += 1
        } operation: {
          let fileURL = URL(fileURLWithPath: UUID().uuidString)
          try inMemoryDataManager.save(redCoverImage, to: fileURL)
          let remindersListAssetRecord = try syncEngine.private.database.record(
            for: RemindersListAsset.recordID(for: 1)
          )
          remindersListAssetRecord.setAsset(
            CKAsset(fileURL: fileURL),
            forKey: "coverImage",
            at: now
          )
          try await syncEngine.modifyRecords(
            scope: .private,
            saving: [remindersListAssetRecord]
          )
          .notify()
        }

        try await userDatabase.read { db in
          let remindersListAsset = try #require(
            try RemindersListAsset.find(1).fetchOne(db)
          )
          #expect(remindersListAsset.coverImage == redCoverImage)
        }
      }

      // * Client receives RemindersListAsset with image data
      // * A moment later client receives the parent RemindersList
      // => Both records (and the image data) should be synchronized
      @available(iOS 17, macOS 14, tvOS 17, watchOS 10, *)
      @Test func assetReceivedBeforeParentRecord() async throws {
        let blackImageURL = Bundle.module.url(forResource: "test-black", withExtension: "svg")!
        let blackCoverImage = try Data(contentsOf: blackImageURL)
        let remindersListRecord = CKRecord(
          recordType: RemindersList.tableName,
          recordID: RemindersList.recordID(for: 1)
        )
        remindersListRecord.setValue("1", forKey: "id", at: now)
        remindersListRecord.setValue("Personal", forKey: "title", at: now)

        let remindersListAssetRecord = CKRecord(
          recordType: RemindersListAsset.tableName,
          recordID: RemindersListAsset.recordID(for: 1)
        )
        remindersListAssetRecord.setValue("1", forKey: "id", at: now)
        remindersListAssetRecord.setValue(
          blackCoverImage,
          forKey: "coverImage",
          at: now
        )
        remindersListAssetRecord.setValue(
          "1",
          forKey: "remindersListID",
          at: now
        )
        remindersListAssetRecord.parent = CKRecord.Reference(
          record: remindersListRecord,
          action: .none
        )

        let remindersListModification = try syncEngine.modifyRecords(
          scope: .private,
          saving: [remindersListRecord]
        )
        try await syncEngine.modifyRecords(scope: .private, saving: [remindersListAssetRecord])
          .notify()
        await remindersListModification.notify()

        assertQuery(RemindersList.all, database: userDatabase.database) {
          """
          ┌─────────────────────┐
          │ RemindersList(      │
          │   id: 1,            │
          │   title: "Personal" │
          │ )                   │
          └─────────────────────┘
          """
        }
        assertQuery(RemindersListAsset.all, database: userDatabase.database) {
          """
          ┌──────────────────────────────────┐
          │ RemindersListAsset(              │
          │   remindersListID: 1,            │
          │   coverImage: Data(18.164 bytes) │
          │ )                                │
          └──────────────────────────────────┘
          """
        }

      }
    }
  }
#endif
